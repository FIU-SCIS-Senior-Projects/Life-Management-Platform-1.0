@model IEnumerable<LifeManagement.Models.Conversation>
@{
    var common = new LifeManagement.Models.Common();
}

<!--Reference the autogenerated SignalR hub script. -->


<div id="chatsection" class="col-md-12">
 
    
        <ul id="discussion">


            @foreach (var item in Model)
            {
            <li class="convoli">
                
                    <div class="convomsg   @(@item.isCoach?" CoachMsg":" UserMsg")">
                        @(@item.isCoach?"Coach: ":"User: ")@item.Message
                    </div>
               
            </li>
            }
        </ul>

    

</div>
<div class="col-md-12">
    <input type="text" class="form-control col-md-10" id="message" placeholder="type message here" />
 </div>










<!--Script references. -->
<!--Reference the SignalR library. -->
<script src="/Scripts/jquery.signalR-2.2.2.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script>
    $(function () {
        setupAllUp();
        var forumid = $('#forumid').val();
        // Declare a proxy to reference the hub.
        var chat = $.connection.chatHub;
        $.connection.hub.qs = 'forumid=' + forumid;
        // Create a function that the hub can call to broadcast messages.
        chat.client.broadcastMessage = function (name, message) {
            // Html encode display name and message.
            var html = '<li><div class="convomsg col-md-12"> ' +
                name +
                ": " +
                message +
                '</div></li>';
            debugger;

            // Add the message to the page.
            $('#discussion').append(html);
            var d = $('#chatsection');
            d.scrollTop(d.prop("scrollHeight"));
        };


        // Set initial focus to message input box.
        $('#message').focus();
        // Start the connection.
        $.connection.hub.start().done(function () {

            $('#message').keyup(function (e) {
                if(e.keyCode == 13)
                {
                     // Call the Send method on the hub.
                chat.server.send(forumid, $('#message').val(),@ViewBag.SenderId,'@ViewBag.isCoach');
                // Clear text box and reset focus for next comment.
                $('#message').val('').focus();
                }

            });
        });
    });
</script>